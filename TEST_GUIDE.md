# 测试指南

## 快速测试最新更新

---

## 问题修复

### ✅ 已修复：无效的会话 ID

**问题原因**:
- 后端重启后，内存中的会话数据丢失
- 前端仍使用旧的会话 ID

**解决方案**:
- ✅ 自动会话恢复机制
- ✅ 文件上传时自动检测并重建会话
- ✅ 其他操作失败时提示用户重新上传

**用户体验**:
- 后端重启后，直接上传文件即可
- 无需刷新页面
- 自动处理会话恢复

---

## 测试步骤

### 1. 启动服务

```bash
cd /Users/jerrywang/Code/Instruct4Edit/html-editor-app

# 确保停止旧服务
pkill -f "python app.py"
pkill -f "react-scripts"

# 启动新服务
./start.sh
```

等待：
- 后端启动：`Running on http://localhost:8000`
- 前端启动：浏览器自动打开 `http://localhost:3000`

---

### 2. 测试基本功能

#### Test 1: 文件上传
1. 准备测试文件：`data/evaluate_samples/sample_1/original.html`
2. 拖放或点击上传
3. ✅ 应该成功，看到左右两侧预览
4. ✅ 顶部显示文件名（前面有圆点）
5. ✅ 状态显示"已连接"（带绿色圆点）

#### Test 2: API 配置折叠
1. 查看"API 配置"区域
2. ✅ 应该默认折叠（只显示标题和"展开"按钮）
3. 点击"展开"按钮
4. ✅ 平滑展开，显示提供商和模型选择
5. 点击"收起"按钮
6. ✅ 平滑收起

#### Test 3: 生成修改建议
1. 上传 HTML 后
2. 滚动到"修改指令"区域
3. 点击"生成修改建议"按钮
4. ✅ 按钮显示"生成中..."（带小 spinner）
5. 等待 5-10 秒
6. ✅ 显示 5 条 AI 生成的建议
7. 点击任意建议
8. ✅ 建议自动填入输入框

#### Test 4: Loading 动画
1. 在输入框输入："将背景色改为深色"
2. 点击"执行修改"
3. ✅ 右侧预览区出现半透明黑色蒙版
4. ✅ 中央显示三环旋转动画
5. ✅ 显示"AI 正在处理中..."
6. 等待完成
7. ✅ 动画消失，显示修改结果

#### Test 5: 历史记录
1. 执行几次修改
2. 查看历史面板
3. ✅ 显示所有修改记录
4. ✅ 每条记录显示：序号、时间、指令、API、模型
5. 点击"回退"按钮
6. ✅ 预览区显示历史版本
7. 点击"下载"按钮
8. ✅ 下载对应版本的 HTML

---

### 3. 测试 UI 风格

#### 检查清单
- ✅ 顶部无 emoji（标题为纯文本）
- ✅ 文件名前有小圆点
- ✅ 状态指示器有彩色圆点
- ✅ 所有按钮无 emoji
- ✅ 上传区域使用 SVG 图标
- ✅ 空状态使用 SVG 图标
- ✅ 整体风格简洁现代

---

### 4. 测试会话恢复

#### 场景 1: 后端重启
1. 上传文件并执行修改
2. 停止后端服务（Ctrl+C）
3. 重新启动后端：`cd backend && source venv/bin/activate && python app.py`
4. 在前端重新上传文件
5. ✅ 应该成功（自动创建新会话）
6. ✅ 可以继续执行修改

#### 场景 2: 长时间空闲
1. 上传文件后等待（不操作）
2. 尝试执行修改
3. 如果会话失效：
4. ✅ 显示"会话已失效，请重新上传 HTML 文件"
5. ✅ 自动清空当前内容
6. 重新上传文件即可继续

---

### 5. 测试错误处理

#### Test 1: 无 API 密钥
1. 停止后端
2. 编辑 `.env`，移除所有 API 密钥
3. 重启后端
4. 上传文件后尝试修改
5. ✅ 显示清晰的错误信息

#### Test 2: 网络错误
1. 停止后端
2. 前端尝试上传文件
3. ✅ 显示连接错误

#### Test 3: 无效指令
1. 输入非常短的指令（如"改"）
2. 执行修改
3. ✅ LLM 可能返回错误或无效 HTML
4. ✅ 系统应该正常处理

---

## 性能测试

### 1. 大文件测试
- 上传 > 100KB 的 HTML
- ✅ 应该正常处理
- 注意：过大文件可能超时

### 2. 连续修改测试
- 执行 10 次连续修改
- ✅ 历史记录正常累积
- ✅ 回退功能正常
- ✅ 内存无明显增长

### 3. 建议生成速度
- 不同提供商对比
- OpenRouter: ~5-10s
- OpenAI: ~8-15s
- Gemini: ~5-10s

---

## 浏览器控制台检查

### 应该没有的错误
- ❌ CORS 错误
- ❌ 404 错误
- ❌ React 警告

### 正常的日志
- ✅ API 请求和响应
- ✅ 状态更新
- ✅ 组件渲染

---

## 常见问题快速解决

### Q: 上传文件显示"无效的会话 ID"
**A**: 刷新页面或直接重新上传文件（已自动修复）

### Q: 生成建议没有反应
**A**: 检查：
1. 是否已上传 HTML
2. 是否选择了有密钥的 API
3. 查看控制台错误信息

### Q: Loading 动画不显示
**A**: 检查：
1. 前端是否重新启动
2. 浏览器缓存是否清除
3. 控制台是否有 CSS 错误

### Q: API 配置无法折叠
**A**: 
1. 清除浏览器缓存
2. 硬刷新（Cmd+Shift+R）
3. 使用无痕模式测试

---

## 验证成功标准

### ✅ 基本功能
- [x] 文件上传成功
- [x] 修改执行成功
- [x] 预览显示正常
- [x] 历史记录正常
- [x] 下载文件成功

### ✅ 新功能
- [x] API 配置可折叠
- [x] 建议生成成功
- [x] Loading 动画显示
- [x] 会话自动恢复

### ✅ UI 优化
- [x] 无 emoji
- [x] SVG 图标正常
- [x] 样式现代简洁
- [x] 状态指示清晰

---

## 报告问题

如果遇到问题，收集以下信息：

1. **浏览器控制台截图**（F12）
2. **错误提示文本**
3. **操作步骤**
4. **后端日志**：`cat backend.log`

---

**测试愉快！** 如有问题随时反馈。

